# abstract
로봇 용접에 AI를 적용하는 방법
로봇 용접은 많은 산업 분야에서 널리 사용되는 기술이지만 현재 로봇은 용접 과정에서 다양한 이유로 인해 발생하는
용접 결함을 감지할 수 있는 능력이 없다. 
마이크와 카메라로 용접 과정을 녹화하여 실시간으로 용접 결함을 감지하기 위해 딥러닝 방법을 적용
다양한 용접 유형, 재료 및 다양한 결함 범주를 다루는 4000개 이상의 용접 샘플이 있는 대규모 데이터 베이스를 
기반으로 한다.
모든 딥러닝 모델은 가능한 결함의 공간이 크고 데이터의 결함에 편항이 포함될 수 있기 때문에 비지도 방식으로 훈련된다.
대부분의 용접 결함 범주에 대한 신뢰할 수 있는 실시간 감지가 오디오와 비디오 모두에서 실현 가능하다는 것을 보여주며,
두 가지 방식을 결합하여 개선을 달성했다. 
특히, 다중 모드 접근 방식은 데이터의 11개 결함 유형 모두에 대해 평균 AUC 0.92를 달성한다.
결함 유형별 결과 분석과 향후 작업에 대한 논의로 논문을 마무리한다. 

# introduction
로봇 아크 용접을 자동화하기 위해 로봇을 사용하는 것은 많은 산업 분야에서 핵심 제조 기술이다. 
용접 품질은 여러 요인에 따라 달라지기 때문에 프로세스의 각 단계를 완벽하게 반복하는 로봇조차 때때로 결함이 있는 용접을
생성한다. 
용접 공정에서 결함이 감지되는 시간은 문제 수정과 관련된 비용에 직접적인 영향을 미친다. 
따라서 전반적인 결함을 최소화하고 수정 비용을 줄이기 위해 용접 후 결함 감지보다는 실시간으로, 즉 용접 공정 중에 
이상을 감지하는 것에 대한 관심이 높아지고 있다. 
이상적으로, 미래의 지능형 제조 시스템은 용접 공정에서 고장이 발생하기 시작하기 전에 용접 로봇의 매개변수를 자동으로 
조정할 수 있어야 한다.
이 연구에서는 카메라와 마이크를 사용하여 실시간으로 자동 용접 결함 감지를 위한 딥러닝 모델의 사용을 조사한다. 
카메라는 용접 풀 형상 및 진동을 모니터링할 수 있으며, 이는 용접 결함을 예측하는 것으로 알려져 있다.
카메라는 용접 풀에 대한 시야를 확보해야 하며, 이로 인해 장착 옵션이 제한되는 경우가 많다. 
반면에 마이크는 가시선 없이 용접 공정에서 가청 장채를 캡처할 수 있다. 
결함에 대한 유용한 정보를 제공하는 것으로 나타났다. 
우리는 여러 결함 유형에 대한 경험 섹션에서 시각적으로 청각적으로 더 잘 감지 할 수 있는지 여부와 두 가지 양식이
조합되어 작동하는지 조사한다.
현재의 딥러닝 모델은 파라미터를 추정하기 위해 많은 양의 훈련 데이터를 필요로 한다. 
우리는 4000개 이상의 양호한 용접 및 결함이 있는 용접 샘플을 수집하여 이 문제를 해결하는데, 이는 우리가 아는 한 문헌의
유사한 데이터 세트에 대해 보고된 것보다 훨씬 더 많다.
그러나 실제 응용 분야에서 예상할 수 있는 입력 신호의 변동을 감안할 때 각 관련 결함 유형을 안정적으로 구별할 수 있는
분류기를 훈련시키기에는 샘플 수가 너무 적다.
따라서 우리는 비지도 이상 감지 접근 방식으로 용접 결함 감지 문제를 해결하기로 결정
이상 탐지 모델은 양호한 용접부에 대해서만 훈련되며, 데이터 세트의 모든 결함은 평가 중에만 발생하며 훈련에서는 보이지 않는다.
이로 인해 결함별 성능을 조정하기가 더 어려워지지만 결과 성능이 실제 애플리케이션을 더 잘 대표한다. 
수많은 저자가 치신 데이터 기반 알고리즘을 사용하여 개선 비용이 많이 들 수 있는 용접 결함 탐지를 개선하는 방법을 탐구했다.
시퀀스 태깅과 로지스틱 회귀를 사용하여 용접 결함을 감지했다. 
용접 후 이미지를 사용하여 결함을 분류했다. 
적외선 카메라의 열화상 이미지 시퀀스를 활용하여 결함을 감지했다. 
우리의 작업은 진동 또는 음향 방출 센서를 사용하는 경향이 있는 예측 유지 관리 솔루션과도 관련이 있다. 
음향 방출 센서는 용접 품질을 모니터링하는 데에도 성공적으로 사용되었다. 
회전 기계의 90% 가 고장 지점이 되는 경향이 있는 롤링 요소 베어링을 사용하기 때문에 기계 상태 모니터링을 위해 
이러한 유형의 센서를 사용하는 데는 그만한 이유가 있다. 
따라서 마이크와 카메라가 음향 방출 또는 진동센서보다 용접 결함을 감지하는데 더 적합할 것으로 예상된다. 
주요 기여
실제 산업 환경에서 로봇 아크 용접 샘플의 대규모 다중 모드 데이터 세트를 수집
다양한 용접 유형, 다양한 용접 매개변수 구성 및 강철 유형
심층적인 ML 모델을 훈련할 수 있다.
이러한 심층 ML 모델을 통해 카메라와 마이크가 실시간 용접 결함 감지에 적합한 센서임을 입증할 수 있다.
당사의 비지도 접근 방식은 모델이 데이터 수집 설정에 특정한 결함 특성에 편향되지 않도록 하고 
서로 다른 결함 유형 및 양식 간의 결과를 비교할 수 있도록 한다. 
마지막으로, 두 센서 유형의 다중 모드 조합을 사용하여 결함 감지 성능을 향상시킬 수 있음을 보여준다. 
다음 섹션에서는 데이터 세트를 수집하는 방법에 대한 포괄적인 설명을 제공한다. 
이 데이터 세트에서 단일 및 다중 모드 방식으로 훈련된 비지도 알고리즘의 성능은 실험적으로 평가되고 결론을 제시한다.

2. Data Set
데이터 수집의 목표는 가장 중요한 용접 범주 각각에 대해 충분한 샘플을 기록하여 양식 및 용접 결함 유형 간에
통계적으로 유효한 비교를 수행하는 것이었다. 
용접부는 두 가지 유형의 강철과 두께를 사용하는 6축 아크 용접 로봇을 사용하여 생성.
강종 유형은 인도에서 자동차 응용 분야에 자주 사용되는 품종으로 선택
FE410: 일반적인 자동차용 강철
BSK46: 탄소 함량이 높고 고강도 구조용 강철
7mm → 대부분의 샘플
3mm → 특정 결함(예: Burnthrough, 용접이 너무 깊이 진행되어 철판이 뚫리는 현상) 유도 시 사용

2.1 Recording Setup, Data Collection Procedure, and Limitations.
데이터 수집 스테이션은 ALL-V6 6축 아크 용접 로봇, intel i7 기반 워크스테이션 및 카메라, 2개의 고대역폭 마이크, 오디오 인터페이스
(이 마이크는 더 높은 주파수에서 용접 결함의 관찰 가능성에 대한 연구를 가능하게 하기 위해 선택)
오디오 샘플은 192KHz 샘플링 속도를 사용하여 녹음되었으며 무손실 FLAC 형식으로 저장되었다.
비디오 샘플은 공칭 30FPS로 녹화되었으며 AVI 형식으로 저장되었다.
데이터셋은 일정량의 레이블 잡음이 포함, 또한 모든 센서가 동시에 녹화를 시작하도록 트리거되었지만 
개별 장치가 응답하는데 걸리는 실제 시간에는 약간의 차이
다중 모드 실험에 필요한 다양한 방식을 정렬하기 위해 시작과 끝의 오디오 및 조명 변경 사항을 검사하여 각 양식에 대한 
용접 시작 및 종료 시간을 식별했다. 
저지연 드라이버가 있는 전용 오디오 인터페이스를 통해 수집된 오디오 데이터는 용접 지속 시간을 결정하기 위한 
실측 자료로 사용되었다. 
이러한 방식으로 비디오의 실제 녹화된 초당 프레임 수가 예상되는 30FPS와 다르다는 것이 확인되었다.
로봇 명령 신호에 쉽게 액세스할 수 있는 경우 이러한 수집 후 정렬이 필요하지 않다는 점을 언급할 가치가 있다. 

2.2 Welding Sample Distribution
데이터세트에는 테이블2에 표시된 12개의 용접 범주에 대한 용접 샘플이 포함되어 있다. 각 용접 범주는 서로 다른
용접 유형에 대해 기록되었으며, 해당되는 경우 서로 다른 재료에 대해 기록되었다. 
테이블3에는 용접 유형별 데이터 세트에 대한 간략한 요약이 포함되어 있다. 
데이터 셑에 대한 전체 분석은 부록A에 포함되어 있다.

3. Experimental Setup
이 연구의 실험은 다음과 같은 질문에 초점을 맞춘다.
1) 오디오 및 비디오 녹화에서 용접 결함을 실시간으로 확실하게 감지할 수 있나?
2) 검출 정확도는 결함 유형 및 양식에 따라 어떻게 달라지나요?
3) 멀티 모달 시스템에서 오디오와 비디오를 결합함으로써 어떤 개선을 기대할 수 있나?
이러한 질문에 답하기 위해 용접 결함 문제를 분류 문제가 아닌 이상 진단 문제로 취급한다.
즉, 우리 모델은 샘플을 용접 범주로 분류하려고 시도하지 않지만 결함 가능성에 따라 증가하는 이상 점수를 생성한다.
실제 사용 사례의 경우 임계값을 미리 결정해야 한다.
용접 중 모델의 점수가 이 임계값을 초과하면 결함이 감지되고 로봇 감독자에게 알림이 전송된다. 
임계값 선택은 특정 사용 사례와 관련된 결함 유형에 대한 모델의 거짓 긍정 및 거짓 부정 비율, 결함의 잘못된 감지와 관련된 
비용 및 누락된 결함으로 인한 비용에 따라 달라진다. 
애플리케이션 평가하고자 하므로 스케일 및 임계값에 독립적인 AUC 메트릭을 사용하여 모델을 구성한다.
AUC는 FPR의 가능한 모든 값에 대해 ROC 곡선 아래 영역으로 정의된다.

검증 및 테스트 세트의 특정 임계값에 대한 FPR 및 TPR을 계산할 때 모델이 모든 시간 프레임에서 이상 점수를 생성하는
실시간 시나리오를 대상으로 한다는 점을 고려해야 한다.
반면에 데이터세트의 각 샘플에는 용접 범주를 나타내는 단일 레이블만 있다.
(예를 들어, 샘플에 '다공성'이라고 지정될 수 있지만 결함이 발생하는 시점에 대한 표시는 없다.
따라서 샘플의 모든 프레임에 대해 모델에서 생성된 모든 점수를 최대값 또는 예상 값을 취하여 집계한다. 
이 작업에서는 용접 결함 감지를 위해 간단하지만 효과적인 CNN을 사용한다.
이를 통해 통찰력을 얻는 데 더 집중하고 대규모 하이퍼 매개 변수 최적화 및 아키텍처 검색을 수행하는데 덜 집중할 수 있다.
오디오의 경우 1D CNN 자동 인코더를 사용했다. 
비디오의 경우 MMAction2 라이브러리에서 제공하는 비교적 간단한 3D CNN을 적용했다.
훈련 데이터에는 양호한 샘플, 즉 정상 상태 샘플만 포함되고 결함은 검증 부분 집합과 테스트 부분 집합 간에 
균등하게 나뉜다.
데이터 세트의 유효성 검사 패널은 하이퍼 매개 변수 튜닝에 사용된다.
유효성 검사 파티션에서 최상의 하이퍼 매개 변수 구성은 테스트 파티션에서 테스트 결과를 생성하는데 사용된다.
두 가지 방식을 모두 사용한 모든 실험에 동일한 파티션이 사용되었다.

3.1 Acoustic Anomaly Detection
오디오 실험의 경우 원래 샘플링 속도인 192kHz를 유지하고 하나의 채널만 사용했다.
오디오 CNN 자동 인코더 아키텍처는 표5에 나와있다.
주요 특징은 병목 계층이 시간 차원을 대부분 보존한다는 것이다. 
이 모델은 PReLU 활성화를 사용하는 출력 계층 이전의 마지막 활성화를 제외한 모든 활성화에서 leaky-ReLU
활성화를 사용한다.
전체적으로 모델에는 31,670,306개의 학습 가능한 매개 변수가 있다.
이 모델의 대기 시간은 모델을 학습하는데 사용되는 홉 길이와 같다.
예를 들어 홉 길이가 8192 및 192kHz 오디오인 경우 대기 시간은 약 42.7ms이다.
이 모델에는 커널 크기가 3인 5개의 인코딩 계층이 있다.
각 인코딩 계층은 시간 차원을 2씩 줄이므로, 입력값은 10개 이상의 프레임을 가져야 한다.
즉, 입력 버퍼는 식2를 충족해야 하며, FFT window는 홉 길이의 정수 배수이다. 
앞의 예제에서 입력 버퍼는 12개*8192개의 샘플을 보유해야 한다.

3.2 Visual Anomaly Detection
시각적 용접 결함 감지에 대한 당사의 접근 방식은 2단계 프로세스를 기반으로 한다.
첫 번째 단계는 각 비디오 프레임을 고정된 차원 기능 베터로 인코딩한다.
이를 위해 64프레임 길이의 창이 전체 비디오에서 프레임별로 이동한다.
64프레임은 30FPS의 프레임 속도에서 약 2초에 해당한다.
창이 관심 프레임의 중심에 있기 때문에 64프레임 창 크기는 실시간 시나리오에서 약 1초의 결함 감지 대기 시간으로
이어진다.
이는 음향 이상 감지보다 더 큰 대기 시간이며, 이는 섹션 4에서 설명할 것처럼 훨씬 더 작은 창으로 기반으로 한다.
그럼에도 불구하고 우리는 많은 사용 사례에서 허용되어야 한다고 믿는다.
각 윈도우는 사전 훈련되고 고정된 slowfast 모델을 사용하여 2304차원 특징 벡터로 인코딩된다.
두번째 단계에서는 인코더, 병목현상 및 디코더로 구성된 자동 인코더 모델을 사용하여 입력 기능 벡터에서 변칙 점수를 생성한다.
인코더는 2304차원 입력 기능 벡터를 ReLU 활성화 및 드롭아웃과 함계 여러 선형 계층을 순차적으로 
통과시켜 64차원 잠재공간에 매핑한다.
각 선형 계층은 차원을 12씩 줄여 64차원 잠재 벡터로 병목 현상을 만든다.
나중에 디코더는 잠재 공간 임베딩을 사용하여 프레임의 원래 기능을 재구성한다.
자동 인코더 모델은 입력 기능 벡터와 디코더의 출력 사이의 평균 제곱 오차로 정의되는 모델의 이상 점수를
최소화하는 용접 비디오로 훈련된다.

3.3 Multi-modal Anomaly Detection
우리는 두 가지 양식의 변칙 점수를 결합하기 위해 후기 융합 접근 방식을 사용했다.
서로 다른 모델에 의해 생성된 변칙 점수는 일반적으로 서로 다른 척도를 갖기 때문에 훈련 세트에 대한 변칙 점수의 평균과 
표준편차를 사용하여 점수를 표준화했다.
다음으로, 검증 데이터에서 볼록 조합에 대해 그리드 검색을 실행하여 오디오 및 비디오 이상 점수의 최적 볼록 조합을 식별했다.
테스트 집합의 변칙 점수를 계산하고 최종 결과를 생성하기 위해 최상의 가중치가 적용된다.

4. Result
4.1 Acoustic Anomaly Detection (음향 이상 탐지)
하이퍼 매개 변수 튜닝을 위해 학습 파티션에서 매개 변수 설정이 다른 별도의 자동 인코더 모델을 학습시키고 validation세트에서 
AUC를 평가했다.
보다 구체적으로, 그리드 검색은 FFT 창 크기4096, 16384, 32768, 65536 및 병목 현상 차원 16, 32, 48, 64에 대해 수행되었다.
홉 길이는 FFT 윈도우 크기의 50%로 고정되었다.
주어진 분석 창에 대해 해당 FFT 창 길이가 샘플링 속도에 비례한다는 점을 독자에게 상기시킨다.
따라서 그리드 검색에 포함된 FFT 창 크기는 데이터 세트의 샘플링 속도에 대해 약 21ms에서 341ms 사이이다.
이러한 모델의 대기 시간 범위는 약 11ms에서 171ms 이다.
모든 모델은 Adam 옵티마이저에 대해 최대 학습률이 50epoch동안 훈련되었다.
훈련 중에 MSE 손실이 최소화되었다. 탭7은 FFT 창 검색 결과를 보여준다.
이 실험은 병목 현상 차원이 48인 16384의 FFT 윈도우가 검증 세트에서 최상의 성능을 생성했음을 확인한다.
AUC 점수를 얻기 위해 기대값, 이동 평균 평활화, 최대값 취하기 등 여러 프레임별 변칙 점수 집계 방법을 살펴보았다.
우리는 평균을 취하는 것이 가장 효과적이었고, MA 평활화가 그 뒤를 바짝 쫒았으며 최대를 취하는 것이 마지막이었다는 것을 발견했다.
공간 고려 사항에 대한 예상 값 점수만 표시한다.
테스트 세트에서 최상의 검증 모델은 AUC가 0.8460이었다. 이는 모델이 과적합되지 않음을 나타내는 검증 세트의 AUC와 크게 다르지 않다.
특정 결함 검충의 어려움에 대한 통찰력을 얻기 위해 결함 유형별로 검증 및 테스트 AUC를 결정했다.

4.2 Visual Anomaly Detection (시각적 이상 징후 탐지)
시각적 결함 감지를 위해 먼저 모든 데이터 파티션의 각 샘플에 대해 사전 훈련된 slowfast모델을 사용하여 차원 2304의 기능 벡터를 생성한다.
두 번째 단계에서는 Adam 옵티마이저를 사용하여 0.0005의 학습률과 MSE 손실 함수를 사용하여 기능 벡터에서 최대 1000epoch 동안 자동 인코더 모델을 훈련한다.
검증 세트에서 가장 잘 수행되는 모델의 경우 단순히 최대 점수를 취하거나, 1초 기간 내에 평균을 내어 점수를 평활화하거나 
전체 2초 창 내에서 평균을 내어 점수를 평활화하는 다양한 방법을 비교하여 점수를 집계한다.
최상의 검증 모델은 검증 및 테스트 데이터에 대해 각각 0.9052 및 0.8977의 전체 AUC를 얻는다.

4.3 Multi-modal Anomaly Detection (멀티모달 탐지)
비디오 및 오디오 모달리티의 후기 융합 조합에 대한 입력 점수는 각 모달리티에 대해 가장 성능이 좋은 모델, 즉 FFT 창 크기 16384와 병목 현상 차원 48을 
사용하는 오디오 모델과 2s-MA 스무딩을 사용하는 비디오 모델을 사용하여 생성되었다.
검증 데이터의 양식에 대한 가중치는 단계 크기가 0.01인 그리드 검색을 사용하여 결정했다.
이런 식으로 오디오 및 비디오 점수에 대해 각각 0.37과 0.63이라는 최상의 가중치를 찾았다.
이러한 가중치는 비디오 형식의 더 강력한 성능을 감안할 때 의미가 있다.
최적 가중치를 사용하여 0.9178의 전체 최상의 테스트 AUC를 얻었다. 

오디오의 경우 11개의 결함 범주 중 8개에 대해 AUC 메트릭이 11개 개선되었다.
비디오의 경우 AUC가 11개 범주 중 7개 범주에서 개선되었다.
가장 성능이 약한 결함 범주가 모두 개선되었다는 점을 언급할 가치가 있다.
특히, 오디오는 AUC가 0.7초인 4가지 결함 범주가 있었으며 모두 융합의 이점을 얻었다.

5. Conclusions and Future Work
모달리티를 사용하면 가장 중요한 결함 유형을 실시간으로 안정적으로 감지할 수 있다.
최고의 오디오 모델은 대기 시간이 42.7ms 였으며 다공성, 겹침 및 분화구 균열을 감지하는데 가장 적합했다.
번스루, 과도한 펜 에턴, 스패터 및 뒤틀림에 대한 AUC 점수가 가장 낮다.
비디오는 일반적으로 오디오보다 더 나은 AUC를 보여주지만 전체 모델 크기가 더 크고 대기 시간이 더 길다는 대가를 치르게 된다.
비디오를 사용하면 다공성, 과도한 블록 및 스패터에 대해 최상의 감지 성능을 얻을 수 있다.
우리는 융합 부족과 뒤틀림으로 인해 가장 낮은 성능을 관찰한다.
두 가지 방식에 대해 정규화된 점수의 후기 융합을 사용하는 결합된 접근 방식이 개선을 제공한다는 것을 보여주었다.
보다 구체적으로 말하자면, 모든 결점 유형에 대한 AUC 점수는 평균 0.92이며 가장 낮은 점수는 약 0.8이다.
두 가지 방식 모두에서 실적이 가장 저조한 카테고리가 모두 개선되었다. 향후 연구에서는 두 가지 방식을 결합하는 보다 정교한 방법을 조사할 것이다.
또한, 데이터셋의 가장 큰 한계는 감독된 방식으로 수집되었다는점, 즉 실험에 충분한 수의 결함샘플이 필요했기 때문에 로봇이 의도적으로 결함을 
이 접근 방식은 결함이 무작위로 드물게 발생하는 실제 사용 사례와 잠재적으로 일치하지 않는다.
우리는 결함이 데이터 세트에서보다 덜 두드러지게 나타날 것으로 예상한다.
따라서 협업 파트너의 실제 생산 과정을 기록하고 결함이 발생할 때 라벨을 부착할 계획이다. 이를 토앻 보다 현실적인 환경에서 제안된 방법을 검증할 수 있다.







